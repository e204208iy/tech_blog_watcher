name: Run Tech Blog Watcher

on:
  schedule:
    - cron: '0 23 * * *'  # JST 8:00
  workflow_dispatch:

jobs:
  notify:
    runs-on: ubuntu-latest
    timeout-minutes: 2  # é•·ããªã‚Šã™ããŸã‚‰æ­¢ã‚ã‚‹

    steps:
      - name: ğŸš€ Checkout repository (shallow)
        uses: actions/checkout@v4
        with:
          fetch-depth: 1  # æœ€å°é™ã®Gitå±¥æ­´

      - name: âš¡ Cache cargo
        uses: actions/cache@v3
        with:
          path: |
            ~/.cargo/registry
            ~/.cargo/git
            target
          key: ${{ runner.os }}-cargo-${{ hashFiles('**/Cargo.lock') }}
          restore-keys: |
            ${{ runner.os }}-cargo-

      - name: ğŸ¦€ Install Rust (stable)
        uses: actions-rs/toolchain@v1
        with:
          toolchain: stable
          override: true

      - name: ğŸ“¦ Build
        run: cargo build --release --quiet

      - name: ğŸ“° Run notifier
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
        run: ./target/release/tech_blog_watcher

# jobs:
#   run:
#     runs-on: ubuntu-latest

#     steps:
#     - name: Checkout repository
#       uses: actions/checkout@v4

#     - name: Set up Rust
#       uses: actions-rs/toolchain@v1
#       with:
#         toolchain: stable
#         override: true

#     - name: Build and Run
#       env:
#         SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
#       run: |
#         cargo build --release
#         ./target/release/tech_blog_watcher